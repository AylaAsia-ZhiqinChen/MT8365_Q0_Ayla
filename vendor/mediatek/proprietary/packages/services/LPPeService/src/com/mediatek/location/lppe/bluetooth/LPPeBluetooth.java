// This source code is generated by UdpGeneratorTool, not recommend to modify it directly
package com.mediatek.location.lppe.bluetooth;

import java.util.Arrays;

import com.mediatek.socket.base.SocketUtils.BaseBuffer;
import com.mediatek.socket.base.SocketUtils.ProtocolHandler;
import com.mediatek.socket.base.SocketUtils.UdpServerInterface;
import com.mediatek.socket.base.UdpClient;

/**
 * This is an LPPe interface between Bluetooth and AGPSD <br>
 * agpsVersion <br>
 * 1 first MP version <br>
 * bluetoothVersion <br>
 * 1 first MP version <br>
 */
public class LPPeBluetooth {
    public final static int PROTOCOL_TYPE = 202;
    public final static int MAX_BUFF_SIZE = 36;
    public final static int REQUEST_CAPABILITIES = 0;
    public final static int PROVIDE_CAPABILITIES = 1;
    public final static int START_MEASUREMENT = 2;
    public final static int STOP_MEASUREMENT = 3;
    public final static int PROVIDE_MEASUREMENT = 4;
    public final static int PROVIDE_MEASUREMENT_FINISHED = 5;

    public static class LPPeBluetoothSender {
        public boolean requestCapabilities(UdpClient client, int agpsVersion) {
            synchronized(client) {
                if(!client.connect()) {
                    return false;
                }
                BaseBuffer buff = client.getBuff();
                buff.putInt(PROTOCOL_TYPE);
                buff.putInt(REQUEST_CAPABILITIES);
                buff.putInt(agpsVersion);
                boolean _ret = client.write();
                client.close();
                return _ret;
            }
        }

        public boolean provideCapabilities(UdpClient client, int btVersion, BluetoothProvideCapabilities capabilities) {
            synchronized(client) {
                if(!client.connect()) {
                    return false;
                }
                BaseBuffer buff = client.getBuff();
                buff.putInt(PROTOCOL_TYPE);
                buff.putInt(PROVIDE_CAPABILITIES);
                buff.putInt(btVersion);
                buff.putCodable(capabilities);
                boolean _ret = client.write();
                client.close();
                return _ret;
            }
        }

        public boolean startMeasurement(UdpClient client, boolean hideIcon, BluetoothMeasurementRequest request) {
            synchronized(client) {
                if(!client.connect()) {
                    return false;
                }
                BaseBuffer buff = client.getBuff();
                buff.putInt(PROTOCOL_TYPE);
                buff.putInt(START_MEASUREMENT);
                buff.putBool(hideIcon);
                buff.putCodable(request);
                boolean _ret = client.write();
                client.close();
                return _ret;
            }
        }

        public boolean stopMeasurement(UdpClient client) {
            synchronized(client) {
                if(!client.connect()) {
                    return false;
                }
                BaseBuffer buff = client.getBuff();
                buff.putInt(PROTOCOL_TYPE);
                buff.putInt(STOP_MEASUREMENT);
                boolean _ret = client.write();
                client.close();
                return _ret;
            }
        }

        public boolean provideMeasurement(UdpClient client, BluetoothMeasurement meas) {
            synchronized(client) {
                if(!client.connect()) {
                    return false;
                }
                BaseBuffer buff = client.getBuff();
                buff.putInt(PROTOCOL_TYPE);
                buff.putInt(PROVIDE_MEASUREMENT);
                buff.putCodable(meas);
                boolean _ret = client.write();
                client.close();
                return _ret;
            }
        }

        public boolean provideMeasurementFinished(UdpClient client) {
            synchronized(client) {
                if(!client.connect()) {
                    return false;
                }
                BaseBuffer buff = client.getBuff();
                buff.putInt(PROTOCOL_TYPE);
                buff.putInt(PROVIDE_MEASUREMENT_FINISHED);
                boolean _ret = client.write();
                client.close();
                return _ret;
            }
        }

    }

    public static abstract class LPPeBluetoothReceiver implements ProtocolHandler {

        public abstract void requestCapabilities(int agpsVersion);

        public abstract void provideCapabilities(int btVersion, BluetoothProvideCapabilities capabilities);

        public abstract void startMeasurement(boolean hideIcon, BluetoothMeasurementRequest request);

        public abstract void stopMeasurement();

        public abstract void provideMeasurement(BluetoothMeasurement meas);

        public abstract void provideMeasurementFinished();


        public boolean readAndDecode(UdpServerInterface server) {
            if (!server.read()) {
                return false;
            }
            return decode(server);
        }

        @Override
        public int getProtocolType() {
            return PROTOCOL_TYPE;
        }

        @Override
        public boolean decode(UdpServerInterface server) {
            boolean _ret = true;
            BaseBuffer buff = server.getBuff();
            buff.setOffset(4); // skip protocol type
            int _type = buff.getInt();
            switch (_type) {
            case REQUEST_CAPABILITIES: {
                int agpsVersion = (int) buff.getInt();
                requestCapabilities(agpsVersion);
                break;
            }
            case PROVIDE_CAPABILITIES: {
                int btVersion = (int) buff.getInt();
                BluetoothProvideCapabilities capabilities = (BluetoothProvideCapabilities) buff.getCodable(BluetoothProvideCapabilities._instance);
                provideCapabilities(btVersion, capabilities);
                break;
            }
            case START_MEASUREMENT: {
                boolean hideIcon = (boolean) buff.getBool();
                BluetoothMeasurementRequest request = (BluetoothMeasurementRequest) buff.getCodable(BluetoothMeasurementRequest._instance);
                startMeasurement(hideIcon, request);
                break;
            }
            case STOP_MEASUREMENT: {
                stopMeasurement();
                break;
            }
            case PROVIDE_MEASUREMENT: {
                BluetoothMeasurement meas = (BluetoothMeasurement) buff.getCodable(BluetoothMeasurement._instance);
                provideMeasurement(meas);
                break;
            }
            case PROVIDE_MEASUREMENT_FINISHED: {
                provideMeasurementFinished();
                break;
            }
            default: {
                _ret = false;
                break;
            }
            }
            return _ret;
        }
    }

}
