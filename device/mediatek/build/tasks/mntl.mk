# build mntl partition image
ifeq ($(TARGET_USERIMAGES_USE_MNTL), true)
include $(PRODUCT_OUT)/partition_nand.mk
MKMNTL := $(HOST_OUT_EXECUTABLES)/mkmntl$(HOST_EXECUTABLE_SUFFIX)
MNTL_PARTITION_PATH := device/mediatek/build/build/tools/partition
MNTL_PARTITION_XML := $(PRODUCT_OUT)/partition_nand.xml
MNTL_GPT := $(PRODUCT_OUT)/ftl_gpt.bin
INSTALLED_MNTLIMAGE_TARGET := $(PRODUCT_OUT)/mntl.img

MKMNTL_PARAMETERS := -m $(BOARD_FLASH_PAGE_SIZE) -f $(MNTL_GPT) -p 0

MKMNTL_PARAMETERS += -f $(INSTALLED_SYSTEMIMAGE) -p $(BOARD_SYSTEMIMAGE_START_SECTOR)

ifdef INSTALLED_VENDORIMAGE_TARGET
  MKMNTL_PARAMETERS += -f $(INSTALLED_VENDORIMAGE_TARGET) -p $(BOARD_VENDORIMAGE_START_SECTOR)
endif

ifdef INSTALLED_CACHEIMAGE_TARGET
  MKMNTL_PARAMETERS += -f $(INSTALLED_CACHEIMAGE_TARGET) -p $(BOARD_CACHEIMAGE_START_SECTOR)
endif

MKMNTL_PARAMETERS += -f $(INSTALLED_USERDATAIMAGE_TARGET) -p $(BOARD_USERDATAIMAGE_START_SECTOR)

MKMNTL_PARAMETERS += -o $(INSTALLED_MNTLIMAGE_TARGET)

.PHONY: mntlimage
mntlimage: $(INSTALLED_MNTLIMAGE_TARGET)
$(INSTALLED_MNTLIMAGE_TARGET): PRIVATE_PARAMETERS := $(MKMNTL_PARAMETERS)
$(INSTALLED_MNTLIMAGE_TARGET): $(INSTALLED_SYSTEMIMAGE)
$(INSTALLED_MNTLIMAGE_TARGET): $(INSTALLED_VENDORIMAGE_TARGET)
$(INSTALLED_MNTLIMAGE_TARGET): $(INSTALLED_CACHEIMAGE_TARGET)
$(INSTALLED_MNTLIMAGE_TARGET): $(INSTALLED_USERDATAIMAGE_TARGET)
$(INSTALLED_MNTLIMAGE_TARGET): $(MNTL_GPT)
$(INSTALLED_MNTLIMAGE_TARGET): $(MKMNTL)
	@echo "Install mntl image: $(MKMNTL) $(PRIVATE_PARAMETERS)"
	$(MKMNTL) $(PRIVATE_PARAMETERS)

$(MNTL_GPT): $(MNTL_PARTITION_PATH)/gen-mntl-gpt.py $(MNTL_PARTITION_XML)
	python $(MNTL_PARTITION_PATH)/gen-mntl-gpt.py $(MNTL_PARTITION_XML) $@

droid: mntlimage

endif
