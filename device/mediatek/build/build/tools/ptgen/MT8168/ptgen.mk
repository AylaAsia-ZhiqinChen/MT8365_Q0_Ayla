ifndef TARGET_BOARD_PLATFORM
  $(error TARGET_BOARD_PLATFORM is not defined)
endif
ifndef MTK_PTGEN_CHIP
  $(error MTK_PTGEN_CHIP is not defined)
endif
ifndef MTK_PTGEN_OUT_DIR
  $(error MTK_PTGEN_OUT_DIR is not defined)
endif

ifeq ($(MTK_GPT_SCHEME_SUPPORT),yes)
MTK_PTGEN_PERL := device/mediatek/build/build/tools/ptgen/$(MTK_PTGEN_CHIP)/ptgen.pl
MTK_PTGEN_XLS := $(wildcard device/mediatek/build/build/tools/ptgen/$(MTK_PTGEN_CHIP)/*.xls)
else
ifeq ($(MTK_SLC_BUFFER_SUPPORT),yes)
MTK_PTGEN_PERL := device/mediatek/build/build/tools/ptgen/$(MTK_PTGEN_CHIP)/ptgen_nand.pl
else
ifeq ($(MTK_COMBO_NAND_SUPPORT),yes)
MTK_PTGEN_PERL := device/mediatek/build/build/tools/ptgen/$(MTK_PTGEN_CHIP)/ptgen_nandx.pl
else
MTK_PTGEN_PERL := device/mediatek/build/build/tools/ptgen/$(MTK_PTGEN_CHIP)/ptgen_pmt.pl
endif
endif
MTK_PTGENXLS_PERL := device/mediatek/build/build/tools/ptgen/$(MTK_PTGEN_CHIP)/ptgen_xls.pl
MTK_PTGEN_XLS := $(shell PLATFORM=${MTK_PTGEN_CHIP} PROJECT=${MTK_TARGET_PROJECT} perl $(MTK_PTGENXLS_PERL))
endif
MTK_PTGEN_COMMAND := \
	PLATFORM=${MTK_PTGEN_CHIP} \
	MTK_TARGET_PROJECT=${MTK_TARGET_PROJECT} \
	TARGET_BUILD_VARIANT=${TARGET_BUILD_VARIANT} \
	MTK_NAND_PAGE_SIZE=${MTK_NAND_PAGE_SIZE} \
	MTK_EMMC_SUPPORT=${MTK_EMMC_SUPPORT} \
	MTK_TC1_FEATURE=${MTK_TC1_FEATURE} \
	MTK_LDVT_SUPPORT=${MTK_LDVT_SUPPORT} \
	MTK_EMMC_SUPPORT_OTP=${MTK_EMMC_SUPPORT_OTP} \
	MTK_SHARED_SDCARD=${MTK_SHARED_SDCARD} \
	MTK_CIP_SUPPORT=${MTK_CIP_SUPPORT} \
	MTK_FAT_ON_NAND=${MTK_FAT_ON_NAND} \
	MTK_SPI_NAND_SUPPORT=${MTK_SPI_NAND_SUPPORT} \
	MTK_NAND_UBIFS_SUPPORT=${MTK_NAND_UBIFS_SUPPORT} \
	MTK_COMBO_NAND_SUPPORT=${MTK_COMBO_NAND_SUPPORT} \
	MTK_NAND_MTK_FTL_SUPPORT=${MTK_NAND_MTK_FTL_SUPPORT} \
	MTK_MLC_NAND_SUPPORT=${MTK_MLC_NAND_SUPPORT} \
	MTK_TLC_NAND_SUPPORT=${MTK_TLC_NAND_SUPPORT} \
	MTK_TLC_SLC_RATIO=${MTK_TLC_SLC_RATIO} \
	MTK_SLC_BUFFER_SUPPORT=${MTK_SLC_BUFFER_SUPPORT} \
	MTK_IPOH_SUPPORT=${MTK_IPOH_SUPPORT} \
	MTK_RAWFS_NAND_SUPPORT=${MTK_RAWFS_NAND_SUPPORT} \
	MTK_PLATFORM=${MTK_PLATFORM} \
	MTK_YAML_SCATTER_FILE_SUPPORT=${MTK_YAML_SCATTER_FILE_SUPPORT} \
	PL_MODE=${PL_MODE} \
	MTK_PARTITION_TABLE_PLAIN_TEXT=${MTK_PARTITION_TABLE_PLAIN_TEXT} \
	MTK_ATF_SUPPORT=${MTK_ATF_SUPPORT} \
	MTK_TEE_SUPPORT=${MTK_TEE_SUPPORT} \
	MTK_IN_HOUSE_TEE_SUPPORT=${MTK_IN_HOUSE_TEE_SUPPORT} \
	MTK_PERSIST_PARTITION_SUPPORT=${MTK_PERSIST_PARTITION_SUPPORT} \
	MTK_DRM_KEY_MNG_SUPPORT=${MTK_DRM_KEY_MNG_SUPPORT} \
	MTK_FACTORY_RESET_PROTECTION_SUPPORT=${MTK_FACTORY_RESET_PROTECTION_SUPPORT} \
	MTK_BASE_PROJECT=${MTK_BASE_PROJECT} \
	PTGEN_ENV="ANDROID" \
	PTGEN_MK_OUT=${MTK_PTGEN_OUT} \
	TMP_OUT_PATH=${MTK_PTGEN_TMP_OUT} \
	OUT_DIR=${MTK_PTGEN_OUT_DIR} \
	PRELOADER_TARGET_PRODUCT=${PRELOADER_TARGET_PRODUCT} \
	PTGEN_PROJECT_OUT=${MTK_PTGEN_OUT} \
	MTK_NAND_MTK_FTL_SUPPORT=${MTK_NAND_MTK_FTL_SUPPORT} \
	MNTL_SUPPORT=${MNTL_SUPPORT} \
	MTK_AB_OTA_UPDATER=${MTK_AB_OTA_UPDATER} \
	MTK_DTBO_FEATURE=${MTK_DTBO_FEATURE} \
	TARGET_COPY_OUT_ODM=${TARGET_COPY_OUT_ODM} \
	MTK_DTBO_UPGRADE_FROM_ANDROID_O=${MTK_DTBO_UPGRADE_FROM_ANDROID_O} \
	MTK_BOARD_AVB_ENABLE=${BOARD_AVB_ENABLE} \
	perl $(MTK_PTGEN_PERL)

ifneq ($(CALLED_FROM_SETUP),true)
ifeq ($(shell if [ -e $(MTK_PTGEN_OUT)/partition_size.mk ]; then echo $(MTK_PTGEN_OUT)/partition_size.mk; fi),)
  MTK_PTGEN_RES := $(shell $(MTK_PTGEN_COMMAND) >&2; echo $$?)
  ifneq ($(strip $(MTK_PTGEN_RES)),0)
    $(error ptgen error=$(MTK_PTGEN_RES): $(MTK_PTGEN_COMMAND))
  endif
endif
endif
